const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CPsAi7gg.js","assets/index-DGh-SLQn.css"])))=>i.map(i=>d[i]);
import{a as he,b as me,r as a,c as fe,ad as ct,G as Xe,ae as dt,af as ut,j as e,s as Y,d as ue,e as xe,i as le,k as ne,q as pt,w as gt,l as te,z as ht,ag as mt,ah as ft,ai as xt,aj as Ye,ak as bt,al as vt,am as yt,an as jt,f as oe,a4 as Ct,n as wt,ao as Mt,ap as St,aq as Pe,ar as et,as as It,at as Tt,au as $e,av as We,aw as Oe,ax as At,ay as Et,az as Rt,aA as kt,aB as zt,aC as Dt,aD as Be,aE as _t,aF as Pt,aG as $t,aH as Wt,aI as Ot,aJ as Bt,aK as Nt,aL as Lt,aM as Ft,aN as Ut,B as A,T,aO as Ne,aP as Ht,aQ as Vt,aR as Gt,A as je,aS as Kt,L as tt,I as st,aT as Le,Z as qt,m as Fe,aU as Zt,a7 as Ue}from"./index-CPsAi7gg.js";import{a as Me,b as Se,c as Ie,d as De,D as He}from"./Delete-u1QQWpNt.js";import{C as se}from"./CircularProgress-CXFRefgw.js";import{C as ve}from"./Chip-fN361k0a.js";import{e as Qt,g as Ve,u as Jt,T as ye}from"./TextField-Ltz92wI-.js";import{D as Ge}from"./Divider-QgutM9kn.js";import{A as ie}from"./Alert-b5b2f2eR.js";import{B as Q}from"./Button-C1smkmiK.js";import{C as Xt}from"./CheckCircle-DIEai7Sp.js";import{I as de}from"./IconButton-BH35efnM.js";import{T as _e,A as Yt}from"./ArrowBack-qhwjsXw-.js";import{P as Ke,L as rt,A as es}from"./Person-D8jrqIFT.js";import{S as ts}from"./Send-CMlsRiYe.js";function ss(s){return he("MuiCollapse",s)}me("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const rs=s=>{const{orientation:t,classes:r}=s,n={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return xe(n,ss,r)},os=Y("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:r}=s;return[t.root,t[r.orientation],r.state==="entered"&&t.entered,r.state==="exited"&&!r.in&&r.collapsedSize==="0px"&&t.hidden]}})(le(({theme:s})=>({height:0,overflow:"hidden",transition:s.transitions.create("height"),variants:[{props:{orientation:"horizontal"},style:{height:"auto",width:0,transition:s.transitions.create("width")}},{props:{state:"entered"},style:{height:"auto",overflow:"visible"}},{props:{state:"entered",orientation:"horizontal"},style:{width:"auto"}},{props:({ownerState:t})=>t.state==="exited"&&!t.in&&t.collapsedSize==="0px",style:{visibility:"hidden"}}]}))),as=Y("div",{name:"MuiCollapse",slot:"Wrapper"})({display:"flex",width:"100%",variants:[{props:{orientation:"horizontal"},style:{width:"auto",height:"100%"}}]}),ns=Y("div",{name:"MuiCollapse",slot:"WrapperInner"})({width:"100%",variants:[{props:{orientation:"horizontal"},style:{width:"auto",height:"100%"}}]}),ze=a.forwardRef(function(t,r){const n=fe({props:t,name:"MuiCollapse"}),{addEndListener:f,children:x,className:y,collapsedSize:b="0px",component:p,easing:j,in:g,onEnter:M,onEntered:i,onEntering:S,onExit:v,onExited:C,onExiting:E,orientation:l="vertical",style:h,timeout:k=ct.standard,TransitionComponent:D=Qt,...z}=n,c={...n,orientation:l,collapsedSize:b},m=rs(c),P=Xe(),O=dt(),_=a.useRef(null),N=a.useRef(),V=typeof b=="number"?`${b}px`:b,U=l==="horizontal",H=U?"width":"height",q=a.useRef(null),J=ut(r,q),F=I=>B=>{if(I){const Z=q.current;B===void 0?I(Z):I(Z,B)}},o=()=>_.current?_.current[U?"clientWidth":"clientHeight"]:0,u=F((I,B)=>{_.current&&U&&(_.current.style.position="absolute"),I.style[H]=V,M&&M(I,B)}),w=F((I,B)=>{const Z=o();_.current&&U&&(_.current.style.position="");const{duration:ce,easing:re}=Ve({style:h,timeout:k,easing:j},{mode:"enter"});if(k==="auto"){const d=P.transitions.getAutoHeightDuration(Z);I.style.transitionDuration=`${d}ms`,N.current=d}else I.style.transitionDuration=typeof ce=="string"?ce:`${ce}ms`;I.style[H]=`${Z}px`,I.style.transitionTimingFunction=re,S&&S(I,B)}),R=F((I,B)=>{I.style[H]="auto",i&&i(I,B)}),$=F(I=>{I.style[H]=`${o()}px`,v&&v(I)}),L=F(C),G=F(I=>{const B=o(),{duration:Z,easing:ce}=Ve({style:h,timeout:k,easing:j},{mode:"exit"});if(k==="auto"){const re=P.transitions.getAutoHeightDuration(B);I.style.transitionDuration=`${re}ms`,N.current=re}else I.style.transitionDuration=typeof Z=="string"?Z:`${Z}ms`;I.style[H]=V,I.style.transitionTimingFunction=ce,E&&E(I)}),ee=I=>{k==="auto"&&O.start(N.current||0,I),f&&f(q.current,I)};return e.jsx(D,{in:g,onEnter:u,onEntered:R,onEntering:w,onExit:$,onExited:L,onExiting:G,addEndListener:ee,nodeRef:q,timeout:k==="auto"?null:k,...z,children:(I,{ownerState:B,...Z})=>e.jsx(os,{as:p,className:ue(m.root,y,{entered:m.entered,exited:!g&&V==="0px"&&m.hidden}[I]),style:{[U?"minWidth":"minHeight"]:V,...h},ref:J,ownerState:{...c,state:I},...Z,children:e.jsx(as,{ownerState:{...c,state:I},className:m.wrapper,ref:_,children:e.jsx(ns,{ownerState:{...c,state:I},className:m.wrapperInner,children:x})})})})});ze&&(ze.muiSupportAuto=!0);const ot=a.createContext({});function is(s){return he("MuiAccordion",s)}const Ce=me("MuiAccordion",["root","heading","rounded","expanded","disabled","gutters","region"]),ls=s=>{const{classes:t,square:r,expanded:n,disabled:f,disableGutters:x}=s;return xe({root:["root",!r&&"rounded",n&&"expanded",f&&"disabled",!x&&"gutters"],heading:["heading"],region:["region"]},is,t)},cs=Y(pt,{name:"MuiAccordion",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:r}=s;return[{[`& .${Ce.region}`]:t.region},t.root,!r.square&&t.rounded,!r.disableGutters&&t.gutters]}})(le(({theme:s})=>{const t={duration:s.transitions.duration.shortest};return{position:"relative",transition:s.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(s.vars||s).palette.divider,transition:s.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${Ce.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${Ce.disabled}`]:{backgroundColor:(s.vars||s).palette.action.disabledBackground}}}),le(({theme:s})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(s.vars||s).shape.borderRadius,borderTopRightRadius:(s.vars||s).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(s.vars||s).shape.borderRadius,borderBottomRightRadius:(s.vars||s).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${Ce.expanded}`]:{margin:"16px 0"}}}]}))),ds=Y("h3",{name:"MuiAccordion",slot:"Heading"})({all:"unset"}),us=a.forwardRef(function(t,r){const n=fe({props:t,name:"MuiAccordion"}),{children:f,className:x,defaultExpanded:y=!1,disabled:b=!1,disableGutters:p=!1,expanded:j,onChange:g,square:M=!1,slots:i={},slotProps:S={},TransitionComponent:v,TransitionProps:C,...E}=n,[l,h]=Jt({controlled:j,default:y,name:"Accordion",state:"expanded"}),k=a.useCallback(o=>{h(!l),g&&g(o,!l)},[l,g,h]),[D,...z]=a.Children.toArray(f),c=a.useMemo(()=>({expanded:l,disabled:b,disableGutters:p,toggle:k}),[l,b,p,k]),m={...n,square:M,disabled:b,disableGutters:p,expanded:l},P=ls(m),O={transition:v,...i},_={transition:C,...S},N={slots:O,slotProps:_},[V,U]=ne("root",{elementType:cs,externalForwardedProps:{...N,...E},className:ue(P.root,x),shouldForwardComponentProp:!0,ownerState:m,ref:r,additionalProps:{square:M}}),[H,q]=ne("heading",{elementType:ds,externalForwardedProps:N,className:P.heading,ownerState:m}),[J,F]=ne("transition",{elementType:ze,externalForwardedProps:N,ownerState:m});return e.jsxs(V,{...U,children:[e.jsx(H,{...q,children:e.jsx(ot.Provider,{value:c,children:D})}),e.jsx(J,{in:l,timeout:"auto",...F,children:e.jsx("div",{"aria-labelledby":D.props.id,id:D.props["aria-controls"],role:"region",className:P.region,children:z})})]})});function ps(s){return he("MuiAccordionDetails",s)}me("MuiAccordionDetails",["root"]);const gs=s=>{const{classes:t}=s;return xe({root:["root"]},ps,t)},hs=Y("div",{name:"MuiAccordionDetails",slot:"Root"})(le(({theme:s})=>({padding:s.spacing(1,2,2)}))),ms=a.forwardRef(function(t,r){const n=fe({props:t,name:"MuiAccordionDetails"}),{className:f,...x}=n,y=n,b=gs(y);return e.jsx(hs,{className:ue(b.root,f),ref:r,ownerState:y,...x})});function fs(s){return he("MuiAccordionSummary",s)}const ge=me("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),xs=s=>{const{classes:t,expanded:r,disabled:n,disableGutters:f}=s;return xe({root:["root",r&&"expanded",n&&"disabled",!f&&"gutters"],focusVisible:["focusVisible"],content:["content",r&&"expanded",!f&&"contentGutters"],expandIconWrapper:["expandIconWrapper",r&&"expanded"]},fs,t)},bs=Y(gt,{name:"MuiAccordionSummary",slot:"Root"})(le(({theme:s})=>{const t={duration:s.transitions.duration.shortest};return{display:"flex",width:"100%",minHeight:48,padding:s.spacing(0,2),transition:s.transitions.create(["min-height","background-color"],t),[`&.${ge.focusVisible}`]:{backgroundColor:(s.vars||s).palette.action.focus},[`&.${ge.disabled}`]:{opacity:(s.vars||s).palette.action.disabledOpacity},[`&:hover:not(.${ge.disabled})`]:{cursor:"pointer"},variants:[{props:r=>!r.disableGutters,style:{[`&.${ge.expanded}`]:{minHeight:64}}}]}})),vs=Y("span",{name:"MuiAccordionSummary",slot:"Content"})(le(({theme:s})=>({display:"flex",textAlign:"start",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:s.transitions.create(["margin"],{duration:s.transitions.duration.shortest}),[`&.${ge.expanded}`]:{margin:"20px 0"}}}]}))),ys=Y("span",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper"})(le(({theme:s})=>({display:"flex",color:(s.vars||s).palette.action.active,transform:"rotate(0deg)",transition:s.transitions.create("transform",{duration:s.transitions.duration.shortest}),[`&.${ge.expanded}`]:{transform:"rotate(180deg)"}}))),js=a.forwardRef(function(t,r){const n=fe({props:t,name:"MuiAccordionSummary"}),{children:f,className:x,expandIcon:y,focusVisibleClassName:b,onClick:p,slots:j,slotProps:g,...M}=n,{disabled:i=!1,disableGutters:S,expanded:v,toggle:C}=a.useContext(ot),E=_=>{C&&C(_),p&&p(_)},l={...n,expanded:v,disabled:i,disableGutters:S},h=xs(l),k={slots:j,slotProps:g},[D,z]=ne("root",{ref:r,shouldForwardComponentProp:!0,className:ue(h.root,x),elementType:bs,externalForwardedProps:{...k,...M},ownerState:l,additionalProps:{focusRipple:!1,disableRipple:!0,disabled:i,"aria-expanded":v,focusVisibleClassName:ue(h.focusVisible,b)},getSlotProps:_=>({..._,onClick:N=>{var V;(V=_.onClick)==null||V.call(_,N),E(N)}})}),[c,m]=ne("content",{className:h.content,elementType:vs,externalForwardedProps:k,ownerState:l}),[P,O]=ne("expandIconWrapper",{className:h.expandIconWrapper,elementType:ys,externalForwardedProps:k,ownerState:l});return e.jsxs(D,{...z,children:[e.jsx(c,{...m,children:f}),y&&e.jsx(P,{...O,children:y})]})}),at=s=>{const t=a.useRef({});return a.useEffect(()=>{t.current=s}),t.current};function Cs(s){const{badgeContent:t,invisible:r=!1,max:n=99,showZero:f=!1}=s,x=at({badgeContent:t,max:n});let y=r;r===!1&&t===0&&!f&&(y=!0);const{badgeContent:b,max:p=n}=y?x:s,j=b&&Number(b)>p?`${p}+`:b;return{badgeContent:b,invisible:y,max:p,displayValue:j}}function ws(s){return he("MuiBadge",s)}const ae=me("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),Ee=10,Re=4,Ms=s=>{const{color:t,anchorOrigin:r,invisible:n,overlap:f,variant:x,classes:y={}}=s,b={root:["root"],badge:["badge",x,n&&"invisible",`anchorOrigin${te(r.vertical)}${te(r.horizontal)}`,`anchorOrigin${te(r.vertical)}${te(r.horizontal)}${te(f)}`,`overlap${te(f)}`,t!=="default"&&`color${te(t)}`]};return xe(b,ws,y)},Ss=Y("span",{name:"MuiBadge",slot:"Root"})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),Is=Y("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(s,t)=>{const{ownerState:r}=s;return[t.badge,t[r.variant],t[`anchorOrigin${te(r.anchorOrigin.vertical)}${te(r.anchorOrigin.horizontal)}${te(r.overlap)}`],r.color!=="default"&&t[`color${te(r.color)}`],r.invisible&&t.invisible]}})(le(({theme:s})=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:s.typography.fontFamily,fontWeight:s.typography.fontWeightMedium,fontSize:s.typography.pxToRem(12),minWidth:Ee*2,lineHeight:1,padding:"0 6px",height:Ee*2,borderRadius:Ee,zIndex:1,transition:s.transitions.create("transform",{easing:s.transitions.easing.easeInOut,duration:s.transitions.duration.enteringScreen}),variants:[...Object.entries(s.palette).filter(ht(["contrastText"])).map(([t])=>({props:{color:t},style:{backgroundColor:(s.vars||s).palette[t].main,color:(s.vars||s).palette[t].contrastText}})),{props:{variant:"dot"},style:{borderRadius:Re,height:Re*2,minWidth:Re*2,padding:0}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ae.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:s.transitions.create("transform",{easing:s.transitions.easing.easeInOut,duration:s.transitions.duration.leavingScreen})}}]})));function qe(s){return{vertical:(s==null?void 0:s.vertical)??"top",horizontal:(s==null?void 0:s.horizontal)??"right"}}const Ts=a.forwardRef(function(t,r){const n=fe({props:t,name:"MuiBadge"}),{anchorOrigin:f,className:x,classes:y,component:b,components:p={},componentsProps:j={},children:g,overlap:M="rectangular",color:i="default",invisible:S=!1,max:v=99,badgeContent:C,slots:E,slotProps:l,showZero:h=!1,variant:k="standard",...D}=n,{badgeContent:z,invisible:c,max:m,displayValue:P}=Cs({max:v,invisible:S,badgeContent:C,showZero:h}),O=at({anchorOrigin:qe(f),color:i,overlap:M,variant:k,badgeContent:C}),_=c||z==null&&k!=="dot",{color:N=i,overlap:V=M,anchorOrigin:U,variant:H=k}=_?O:n,q=qe(U),J=H!=="dot"?P:void 0,F={...n,badgeContent:z,invisible:_,max:m,displayValue:J,showZero:h,anchorOrigin:q,color:N,overlap:V,variant:H},o=Ms(F),u={slots:{root:(E==null?void 0:E.root)??p.Root,badge:(E==null?void 0:E.badge)??p.Badge},slotProps:{root:(l==null?void 0:l.root)??j.root,badge:(l==null?void 0:l.badge)??j.badge}},[w,R]=ne("root",{elementType:Ss,externalForwardedProps:{...u,...D},ownerState:F,className:ue(o.root,x),ref:r,additionalProps:{as:b}}),[$,L]=ne("badge",{elementType:Is,externalForwardedProps:u,ownerState:F,className:o.badge});return e.jsxs(w,{...R,children:[g,e.jsx($,{...L,children:J})]})});function As(s){return he("MuiListItemAvatar",s)}me("MuiListItemAvatar",["root","alignItemsFlexStart"]);const Es=s=>{const{alignItems:t,classes:r}=s;return xe({root:["root",t==="flex-start"&&"alignItemsFlexStart"]},As,r)},Rs=Y("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:r}=s;return[t.root,r.alignItems==="flex-start"&&t.alignItemsFlexStart]}})({minWidth:56,flexShrink:0,variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}),nt=a.forwardRef(function(t,r){const n=fe({props:t,name:"MuiListItemAvatar"}),{className:f,...x}=n,y=a.useContext(mt),b={...n,alignItems:y.alignItems},p=Es(b);return e.jsx(Rs,{className:ue(p.root,f),ownerState:b,ref:r,...x})});class ks extends a.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=r.offsetParent,f=xt(n)&&n.offsetWidth||0,x=this.props.sizeRef.current;x.height=r.offsetHeight||0,x.width=r.offsetWidth||0,x.top=r.offsetTop,x.left=r.offsetLeft,x.right=f-x.width-x.left}return null}componentDidUpdate(){}render(){return this.props.children}}function zs({children:s,isPresent:t,anchorX:r,root:n}){const f=a.useId(),x=a.useRef(null),y=a.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:b}=a.useContext(ft);return a.useInsertionEffect(()=>{const{width:p,height:j,top:g,left:M,right:i}=y.current;if(t||!x.current||!p||!j)return;const S=r==="left"?`left: ${M}`:`right: ${i}`;x.current.dataset.motionPopId=f;const v=document.createElement("style");b&&(v.nonce=b);const C=n??document.head;return C.appendChild(v),v.sheet&&v.sheet.insertRule(`
          [data-motion-pop-id="${f}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${j}px !important;
            ${S}px !important;
            top: ${g}px !important;
          }
        `),()=>{C.removeChild(v),C.contains(v)&&C.removeChild(v)}},[t]),e.jsx(ks,{isPresent:t,childRef:x,sizeRef:y,children:a.cloneElement(s,{ref:x})})}const Ds=({children:s,initial:t,isPresent:r,onExitComplete:n,custom:f,presenceAffectsLayout:x,mode:y,anchorX:b,root:p})=>{const j=Ye(_s),g=a.useId();let M=!0,i=a.useMemo(()=>(M=!1,{id:g,initial:t,isPresent:r,custom:f,onExitComplete:S=>{j.set(S,!0);for(const v of j.values())if(!v)return;n&&n()},register:S=>(j.set(S,!1),()=>j.delete(S))}),[r,j,n]);return x&&M&&(i={...i}),a.useMemo(()=>{j.forEach((S,v)=>j.set(v,!1))},[r]),a.useEffect(()=>{!r&&!j.size&&n&&n()},[r]),y==="popLayout"&&(s=e.jsx(zs,{isPresent:r,anchorX:b,root:p,children:s})),e.jsx(bt.Provider,{value:i,children:s})};function _s(){return new Map}const we=s=>s.key||"";function Ze(s){const t=[];return a.Children.forEach(s,r=>{a.isValidElement(r)&&t.push(r)}),t}const Ps=({children:s,custom:t,initial:r=!0,onExitComplete:n,presenceAffectsLayout:f=!0,mode:x="sync",propagate:y=!1,anchorX:b="left",root:p})=>{const[j,g]=vt(y),M=a.useMemo(()=>Ze(s),[s]),i=y&&!j?[]:M.map(we),S=a.useRef(!0),v=a.useRef(M),C=Ye(()=>new Map),[E,l]=a.useState(M),[h,k]=a.useState(M);yt(()=>{S.current=!1,v.current=M;for(let c=0;c<h.length;c++){const m=we(h[c]);i.includes(m)?C.delete(m):C.get(m)!==!0&&C.set(m,!1)}},[h,i.length,i.join("-")]);const D=[];if(M!==E){let c=[...M];for(let m=0;m<h.length;m++){const P=h[m],O=we(P);i.includes(O)||(c.splice(m,0,P),D.push(P))}return x==="wait"&&D.length&&(c=D),k(Ze(c)),l(M),null}const{forceRender:z}=a.useContext(jt);return e.jsx(e.Fragment,{children:h.map(c=>{const m=we(c),P=y&&!j?!1:M===h||i.includes(m),O=()=>{if(C.has(m))C.set(m,!0);else return;let _=!0;C.forEach(N=>{N||(_=!1)}),_&&(z==null||z(),k(v.current),y&&(g==null||g()),n&&n())};return e.jsx(Ds,{isPresent:P,initial:!S.current||r?void 0:!1,custom:t,presenceAffectsLayout:f,mode:x,root:p,onExitComplete:P?void 0:O,anchorX:b,children:c},m)})})},$s=oe([e.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),e.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")]),ke=oe(e.jsx("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z"})),Ws=oe(e.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"})),Os=oe(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"})),Bs=oe(e.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"})),it=oe(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"})),Qe=oe(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),Ns=oe(e.jsx("path",{d:"M14 8c0-2.21-1.79-4-4-4S6 5.79 6 8s1.79 4 4 4 4-1.79 4-4m3 2v2h6v-2zM2 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4"})),Ls=oe([e.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),e.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")]),Fs=oe(e.jsx("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"})),Us=()=>Ct(),be=s=>wt(s),Je=s=>{console.log("🔍 Normalizing user data:",s);const t={...s,subordinates:Array.isArray(s.subordinates)?s.subordinates:[],managers:Array.isArray(s.managers)?s.managers:[]};return console.log("✅ Normalized user data:",t),t},Hs=()=>{const s=Us(),[t,r]=a.useState([]),[n,f]=a.useState(null),[x,y]=a.useState(null),[b,p]=a.useState(!0),[j,g]=a.useState(null),[M,i]=a.useState(!1),[S,v]=a.useState(!1),C=be(o=>n?Lt(o,n.id):[]),E=be(o=>n?Ut(o,n.id):!1),l=be(o=>n?Ft(o,n.id):null),h=be(o=>n?Nt(o,n.id):0),k=be(Ot),D=a.useCallback(()=>Mt(),[]);a.useEffect(()=>{s(St()),console.log("📱 Сессия инициализирована")},[s]),a.useEffect(()=>{const o=setInterval(()=>{k>5e3&&(s(Pe({maxMessagesPerChat:500,maxChatAge:216e5})),console.log("🧹 Хранилище оптимизировано, сообщений было:",k))},6e5);return()=>clearInterval(o)},[s,k]),a.useEffect(()=>{const o=()=>{s(Bt()),console.log("📱 Сессия завершена")},u=()=>{document.hidden&&s(Pe({maxMessagesPerChat:1e3}))};return window.addEventListener("beforeunload",o),document.addEventListener("visibilitychange",u),()=>{window.removeEventListener("beforeunload",o),document.removeEventListener("visibilitychange",u)}},[s]);const z=a.useCallback(async()=>{var o;try{if(console.log("🔍 Загружаем данные пользователя..."),!et()){console.warn("❌ Приложение должно быть открыто из Telegram WebApp"),g("Приложение должно быть открыто из Telegram для корректной работы"),i(!0);return}const u=It();if(!u){console.error("❌ Не удалось получить данные пользователя из Telegram WebApp"),g("Не удалось получить данные пользователя из Telegram"),i(!0);return}console.log("✅ Получены данные пользователя из Telegram:",u);const w=await Tt(),R=Je(w);y(R),console.log("✅ Пользователь успешно загружен:",R),g(null),i(!1)}catch(u){console.error("❌ Ошибка загрузки пользователя:",u),((o=u.response)==null?void 0:o.status)===401||u.isAuthError?(i(!0),g("Приложение должно быть открыто из Telegram для корректной работы")):g("Ошибка загрузки данных пользователя")}},[D]),c=a.useCallback(async()=>{var o,u;try{p(!0);const R=(await $e()).sort(($,L)=>!$.last_message_time&&!L.last_message_time?0:$.last_message_time?L.last_message_time?new Date(L.last_message_time).getTime()-new Date($.last_message_time).getTime():-1:1);r(R),g(null),i(!1)}catch(w){console.error("Error loading chats:",w),((o=w.response)==null?void 0:o.status)===401||w.isAuthError?(i(!0),g("Приложение должно быть открыто из Telegram для корректной работы")):w.isTimeoutError||w.code==="ECONNABORTED"?g("⏱️ Сервер запускается, попробуйте обновить страницу через минуту"):w.isServiceError||((u=w.response)==null?void 0:u.status)===503?g("🔧 Сервер временно недоступен, попробуйте через несколько минут"):g("Ошибка загрузки чатов")}finally{p(!1)}},[]),m=a.useCallback(async()=>{var o;try{const w=(await $e()).sort((R,$)=>!R.last_message_time&&!$.last_message_time?0:R.last_message_time?$.last_message_time?new Date($.last_message_time).getTime()-new Date(R.last_message_time).getTime():-1:1);r(w),g(null),i(!1)}catch(u){console.error("Error refreshing chats:",u),(((o=u.response)==null?void 0:o.status)===401||u.isAuthError)&&i(!0)}},[]),P=a.useCallback(async o=>{var u,w;try{s(We({chatId:o,loading:!0}));const R=await Oe(o);s(At({chatId:o,messages:R.messages})),g(null),i(!1)}catch(R){console.error("Error loading messages:",R),s(Et({chatId:o,error:R.message})),((u=R.response)==null?void 0:u.status)===401||R.isAuthError?(i(!0),g("Приложение должно быть открыто из Telegram для корректной работы")):R.isTimeoutError||R.code==="ECONNABORTED"?g("⏱️ Сервер запускается, сообщения загрузятся автоматически"):R.isServiceError||((w=R.response)==null?void 0:w.status)===503?g("🔧 Сервер временно недоступен, попробуйте обновить чат"):g("Ошибка загрузки сообщений")}finally{s(We({chatId:o,loading:!1}))}},[s]),O=a.useCallback(async o=>{var u,w;try{const $=(await Oe(o)).messages;if($.length>0){const L=$[$.length-1].id;if(h&&L>h){const G=C,ee=new Set(G.map(B=>B.id)),I=$.filter(B=>!ee.has(B.id));if(I.length>0){s(Rt({chatId:o,messages:I})),v(!0),m();try{(w=(u=window.Telegram)==null?void 0:u.WebApp)!=null&&w.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.notificationOccurred("success")}catch{console.log("Haptic feedback not available")}console.log("🔄 Получены новые сообщения")}}}}catch(R){console.error("Error checking new messages:",R)}},[h,C,s,m]),_=a.useCallback(async(o,u)=>{if(u.trim())try{const w={text:u.trim(),message_type:"text",chat_id:o},R=await kt(w);s(zt({chatId:o,message:R})),r($=>$.map(G=>G.id===o?{...G,last_message:u.trim(),last_message_time:new Date().toISOString()}:G).sort((G,ee)=>!G.last_message_time&&!ee.last_message_time?0:G.last_message_time?ee.last_message_time?new Date(ee.last_message_time).getTime()-new Date(G.last_message_time).getTime():-1:1))}catch(w){console.error("Error sending message:",w),g("Ошибка отправки сообщения")}},[x,s]),N=a.useCallback(async(o,u=[],w=[],R)=>{try{const $={title:o,chat_type:u.length+w.length>0?"group":"private",member_ids:u,...R&&{photo_url:R}},L=await Dt($);if(w.length>0){const{inviteMemberByUsername:ee}=await Be(async()=>{const{inviteMemberByUsername:I}=await import("./index-CPsAi7gg.js").then(B=>B.be);return{inviteMemberByUsername:I}},__vite__mapDeps([0,1]));for(const I of w)try{await ee(L.id,I)}catch(B){console.error(`Error inviting ${I}:`,B)}}await c();const G={id:L.id,title:L.title,chat_type:L.chat_type,photo_url:L.photo_url,last_message:void 0,last_message_time:void 0,unread_count:0};return f(G),await P(L.id),L}catch($){throw console.error("Error creating chat:",$),g("Ошибка создания чата"),$}},[c,P]),V=a.useCallback(o=>{f(o),v(!1),P(o.id),o.unread_count>0&&_t(o.id).catch(u=>console.error("Error marking messages as read:",u))},[P]),U=a.useCallback(()=>{f(null),v(!1)},[]),H=a.useCallback(()=>{v(!1)},[]),q=a.useCallback(async o=>{try{const{getChat:u}=await Be(async()=>{const{getChat:R}=await import("./index-CPsAi7gg.js").then($=>$.be);return{getChat:R}},__vite__mapDeps([0,1]));return await u(o)}catch(u){throw console.error("Error loading chat info:",u),g("Ошибка загрузки информации о чате"),u}},[]),J=a.useCallback(async(o,u)=>{try{await Pt(o,u),g(null),n&&n.id===o&&setTimeout(()=>m(),1e3)}catch(w){throw console.error("Error adding member to chat:",w),g("Ошибка добавления участника"),w}},[n,m]),F=a.useCallback(async(o,u)=>{try{await $t(o,u),g(null),n&&n.id===o&&setTimeout(()=>m(),1e3)}catch(w){throw console.error("Error removing member from chat:",w),g("Ошибка удаления участника"),w}},[n,m]);return a.useEffect(()=>{D(),z(),c()},[D,z,c]),a.useEffect(()=>{if(M)return;const o=setInterval(()=>{m()},3e4);return()=>clearInterval(o)},[M,m]),a.useEffect(()=>{if(!n||M)return;const o=setInterval(()=>{O(n.id)},5e3);return()=>clearInterval(o)},[n,M,O]),a.useEffect(()=>{if(M)return;const o=setInterval(async()=>{var u;try{const w=await Wt(),R=Je(w);y(R),m()}catch(w){((u=w.response)==null?void 0:u.status)===404?console.log("Check invitations endpoint not available (404) - skipping"):console.log("No new invitations or error:",w)}},12e4);return()=>clearInterval(o)},[M,m]),{chats:t,currentChat:n,messages:C,currentUser:x,loading:b,messagesLoading:E,error:j||l,isAuthError:M,hasNewMessages:S,markMessagesAsViewed:H,sendNewMessage:_,createNewChat:N,selectChat:V,refreshChats:m,refreshMessages:()=>n&&P(n.id),loadChatInfo:q,addMemberToChat:J,removeMemberFromChat:F,clearCurrentChat:U,checkNewMessages:()=>n&&O(n.id)}},Vs=({open:s,onClose:t})=>{const[r,n]=a.useState([]),[f,x]=a.useState(!1),y=async()=>{var v,C,E;x(!0);const i=[];try{const l=et();i.push({name:"Telegram WebApp",status:l?"success":"warning",message:l?"Приложение запущено в Telegram WebApp":"Приложение запущено вне Telegram (режим разработки)",details:l?"Все функции Telegram WebApp доступны":"Некоторые функции могут работать с ограничениями",suggestions:l?void 0:["Откройте приложение через Telegram бота","Проверьте настройки WebApp в боте"]})}catch(l){i.push({name:"Telegram WebApp",status:"error",message:"Ошибка при проверке Telegram WebApp",details:l instanceof Error?l.message:"Неизвестная ошибка"})}try{const l=Ne();i.push({name:"Telegram Init Data",status:l?"success":"error",message:l?`Данные авторизации найдены (${l.length} символов)`:"Данные авторизации отсутствуют",details:l?`Подпись: ${l.substring(0,50)}...`:"Невозможно получить данные для авторизации на сервере",suggestions:l?void 0:["Перезапустите приложение из Telegram","Проверьте настройки бота","Убедитесь что WebApp правильно настроен"]})}catch(l){i.push({name:"Telegram Init Data",status:"error",message:"Ошибка при получении данных авторизации",details:l instanceof Error?l.message:"Неизвестная ошибка"})}try{await Ht(),i.push({name:"Подключение к серверу",status:"success",message:"Сервер отвечает на запросы",details:"Health check прошел успешно"})}catch(l){const h=l.isMethodError||((v=l.response)==null?void 0:v.status)===405;i.push({name:"Подключение к серверу",status:h?"warning":"error",message:h?"Сервер доступен, но некоторые endpoints могут не работать (ошибка 405)":"Сервер недоступен или не отвечает",details:l.message||"Неизвестная ошибка сервера",suggestions:h?["Проверьте настройки API на сервере","Убедитесь что все endpoints правильно настроены","Свяжитесь с администратором сервера"]:["Проверьте подключение к интернету","Сервер может быть временно недоступен","Попробуйте позже"]})}try{await Vt(),i.push({name:"Конфигурация авторизации",status:"success",message:"Настройки авторизации на сервере корректны",details:"Сервер готов к обработке Telegram авторизации"})}catch(l){const h=l.isMethodError||((C=l.response)==null?void 0:C.status)===405;i.push({name:"Конфигурация авторизации",status:h?"warning":"error",message:h?"Endpoint диагностики недоступен (405), но это не критично":"Проблема с настройками авторизации на сервере",details:l.message||"Ошибка при проверке конфигурации",suggestions:h?["Функция диагностики может быть отключена на сервере","Это не влияет на основную работу приложения"]:["Проверьте настройки Telegram бота на сервере","Убедитесь что TELEGRAM_BOT_TOKEN настроен правильно"]})}const S=Ne();if(S)try{await Gt(S),i.push({name:"Валидация Telegram данных",status:"success",message:"Данные Telegram проходят валидацию на сервере",details:"Подпись данных корректна"})}catch(l){const h=l.isMethodError||((E=l.response)==null?void 0:E.status)===405;i.push({name:"Валидация Telegram данных",status:h?"warning":"error",message:h?"Endpoint валидации недоступен (405)":"Данные Telegram не проходят валидацию",details:l.message||"Ошибка валидации данных",suggestions:h?["Endpoint валидации может быть отключен","Попробуйте основные функции приложения"]:["Данные авторизации могли быть повреждены","Перезапустите приложение из Telegram","Проверьте настройки бота"]})}n(i),x(!1)};a.useEffect(()=>{s&&y()},[s]);const b=i=>{switch(i){case"success":return e.jsx(Xt,{sx:{color:"#4CAF50"}});case"error":return e.jsx(Os,{sx:{color:"#f44336"}});case"warning":return e.jsx(Fs,{sx:{color:"#ff9800"}});case"loading":return e.jsx(se,{size:24});default:return e.jsx(it,{sx:{color:"#2196f3"}})}},p=i=>{switch(i){case"success":return"#4CAF50";case"error":return"#f44336";case"warning":return"#ff9800";default:return"#2196f3"}},j=r.filter(i=>i.status==="error").length,g=r.filter(i=>i.status==="warning").length,M=r.filter(i=>i.status==="success").length;return e.jsxs(Me,{open:s,onClose:t,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{bgcolor:"rgba(35, 43, 59, 0.95)",color:"white",maxHeight:"90vh"}},children:[e.jsxs(Se,{children:[e.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(T,{variant:"h6",children:"Диагностика системы"}),f&&e.jsx(se,{size:24})]}),!f&&r.length>0&&e.jsxs(A,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(ve,{label:`${M} успешно`,color:"success",size:"small"}),g>0&&e.jsx(ve,{label:`${g} предупр.`,sx:{bgcolor:"#ff9800",color:"white"},size:"small"}),j>0&&e.jsx(ve,{label:`${j} ошибок`,color:"error",size:"small"})]})]}),e.jsx(Ie,{sx:{pb:1},children:f?e.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:2,py:4},children:[e.jsx(se,{}),e.jsx(T,{children:"Выполняется диагностика..."})]}):e.jsxs(A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[r.map((i,S)=>e.jsxs(us,{sx:{bgcolor:"rgba(255, 255, 255, 0.05)","&:before":{display:"none"},"&.Mui-expanded":{margin:"8px 0"}},children:[e.jsx(js,{expandIcon:e.jsx(Bs,{sx:{color:"white"}}),children:e.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[b(i.status),e.jsx(T,{sx:{fontWeight:500,flex:1},children:i.name}),e.jsx(ve,{label:i.status==="success"?"OK":i.status==="error"?"Ошибка":"Внимание",size:"small",sx:{bgcolor:p(i.status),color:"white",minWidth:80}})]})}),e.jsxs(ms,{children:[e.jsx(T,{variant:"body2",sx:{mb:1},children:i.message}),i.details&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{sx:{my:1,bgcolor:"rgba(255,255,255,0.1)"}}),e.jsxs(T,{variant:"caption",sx:{color:"#8b95a1"},children:["Детали: ",i.details]})]}),i.suggestions&&i.suggestions.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{sx:{my:1,bgcolor:"rgba(255,255,255,0.1)"}}),e.jsx(T,{variant:"caption",sx:{color:"#8b95a1",display:"block",mb:.5},children:"Рекомендации:"}),i.suggestions.map((v,C)=>e.jsxs(T,{variant:"caption",sx:{color:"#8b95a1",display:"block",ml:2},children:["• ",v]},C))]})]})]},S)),j>0&&e.jsx(ie,{severity:"error",sx:{mt:2,bgcolor:"rgba(244, 67, 54, 0.1)"},children:e.jsx(T,{variant:"body2",children:"Обнаружены критические ошибки. Рекомендуется перезапустить приложение из Telegram."})}),j===0&&g>0&&e.jsx(ie,{severity:"warning",sx:{mt:2,bgcolor:"rgba(255, 152, 0, 0.1)"},children:e.jsx(T,{variant:"body2",children:"Есть некритичные проблемы. Основные функции должны работать."})}),j===0&&g===0&&r.length>0&&e.jsx(ie,{severity:"success",sx:{mt:2,bgcolor:"rgba(76, 175, 80, 0.1)"},children:e.jsx(T,{variant:"body2",children:"Все проверки прошли успешно! Система работает корректно."})})]})}),e.jsxs(De,{children:[e.jsx(Q,{onClick:()=>y(),disabled:f,children:"Повторить диагностику"}),e.jsx(Q,{onClick:t,variant:"contained",children:"Закрыть"})]})]})},lt=({currentPhotoUrl:s,onPhotoChange:t,disabled:r=!1,size:n=80})=>{const[f,x]=a.useState(!1),[y,b]=a.useState(null),[p,j]=a.useState(s||null),g=a.useRef(null),M=C=>{var h;const E=(h=C.target.files)==null?void 0:h[0];if(!E)return;if(!E.type.startsWith("image/")){b("Пожалуйста, выберите изображение");return}if(E.size>5*1024*1024){b("Размер файла не должен превышать 5MB");return}const l=new FileReader;l.onload=k=>{var D;j((D=k.target)==null?void 0:D.result)},l.readAsDataURL(E),i(E)},i=async C=>{var E,l,h,k,D;try{x(!0),b(null),console.log("Загружаем файл:",C.name,C.size,C.type);const z=await Kt(C);t(z.media_url),j(z.media_url),console.log("Фото успешно загружено:",z.media_url)}catch(z){console.error("Error uploading photo:",z);let c="Ошибка загрузки фото";((E=z.response)==null?void 0:E.status)===405?(c="Загрузка фото временно недоступна",console.warn("405 Error: uploadMedia endpoint may not be available")):((l=z.response)==null?void 0:l.status)===413?c="Файл слишком большой":((h=z.response)==null?void 0:h.status)===422?c="Неподдерживаемый формат файла":((k=z.response)==null?void 0:k.status)===401?c="Ошибка авторизации":z.isAuthError?c="Требуется авторизация в Telegram":z.code==="ECONNABORTED"?c="Превышено время ожидания":((D=z.response)==null?void 0:D.status)>=500&&(c="Ошибка сервера, попробуйте позже"),b(c),j(s||null)}finally{x(!1)}},S=()=>{j(null),t(null),b(null),g.current&&(g.current.value="")},v=()=>{var C;r||f||(C=g.current)==null||C.click()};return e.jsxs(A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[e.jsxs(A,{sx:{position:"relative"},children:[e.jsx(je,{src:p||void 0,sx:{width:n,height:n,bgcolor:"#4a9eff",cursor:r||f?"default":"pointer",border:y?"2px solid #f44336":"2px solid transparent","&:hover":{opacity:r||f?1:.8}},onClick:v,children:f?e.jsx(se,{size:n*.4,sx:{color:"white"}}):e.jsx(Ls,{sx:{fontSize:n*.4}})}),p&&!f&&e.jsx(de,{size:"small",sx:{position:"absolute",top:-8,right:-8,bgcolor:"#f44336",color:"white",width:24,height:24,"&:hover":{bgcolor:"#d32f2f"}},onClick:S,children:e.jsx(He,{sx:{fontSize:14}})}),f&&e.jsx(A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(0,0,0,0.5)",borderRadius:"50%"},children:e.jsx(se,{size:n*.3,sx:{color:"white"}})})]}),e.jsxs(A,{sx:{display:"flex",gap:1},children:[e.jsx(Q,{variant:"outlined",size:"small",startIcon:e.jsx(Ws,{}),onClick:v,disabled:r||f,sx:{borderColor:"#4a9eff",color:"#4a9eff","&:hover":{borderColor:"#3d8bdb",bgcolor:"rgba(74, 158, 255, 0.1)"}},children:f?"Загрузка...":"Выбрать фото"}),p&&e.jsx(_e,{title:"Удалить фото",children:e.jsx(de,{size:"small",onClick:S,disabled:r||f,sx:{color:"#f44336","&:hover":{bgcolor:"rgba(244, 67, 54, 0.1)"}},children:e.jsx(He,{})})})]}),e.jsxs(T,{variant:"caption",sx:{color:"#8b95a1",textAlign:"center"},children:["Нажмите на аватар или кнопку для выбора фото",e.jsx("br",{}),"Максимальный размер: 5MB",y&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{color:"#f44336"},children:y}),e.jsx("br",{}),e.jsx("span",{style:{color:"#8b95a1"},children:"Чат можно создать и без фото"})]})]}),e.jsx("input",{ref:g,type:"file",accept:"image/*",style:{display:"none"},onChange:M})]})},Gs=({open:s,onClose:t,currentChat:r,loadChatInfo:n,addMemberToChat:f,removeMemberFromChat:x,currentUserId:y,onChatPhotoUpdate:b})=>{var F;const[p,j]=a.useState(null),[g,M]=a.useState(!1),[i,S]=a.useState(null),[v,C]=a.useState(""),[E,l]=a.useState(""),[h,k]=a.useState("username"),[D,z]=a.useState(!1),[c,m]=a.useState(null),[P,O]=a.useState(!1);a.useEffect(()=>{s&&r&&_()},[s,r]);const _=async()=>{if(r)try{M(!0),S(null);const o=await n(r.id);j(o)}catch(o){S("Не удалось загрузить информацию о чате"),console.error("Error loading chat details:",o)}finally{M(!1)}},N=async o=>{r&&await f(r.id,o)},V=async o=>{if(!r)return;const u=await Le(r.id,o);u.status==="added"?m({type:"success",message:`✅ @${o} найден и добавлен в чат!`}):u.status==="invited"&&m({type:"info",message:`📨 @${o} не найден в базе. Приглашение создано - пользователь будет добавлен при входе в приложение.`}),setTimeout(()=>m(null),5e3)},U=async()=>{if(!v.trim())return;const o=v.trim(),u=parseInt(o);try{z(!0),S(null),isNaN(u)?await V(o.replace(/^@/,"")):await N(u),C(""),await _()}catch(w){console.error("Error adding member (ID path):",w),S("Не удалось добавить участника")}finally{z(!1)}},H=async()=>{if(!(!E.trim()||!r))try{z(!0),S(null),m(null);const o=await Le(r.id,E.trim());o.status==="added"?(m({type:"success",message:`✅ @${E.trim()} добавлен в чат!`}),l(""),await _()):o.status==="invited"&&(m({type:"info",message:`📨 Приглашение отправлено @${E.trim()}. Пользователь будет добавлен автоматически при входе в приложение.`}),l("")),setTimeout(()=>m(null),5e3)}catch(o){console.error("Error adding member by username:",o),m({type:"warning",message:"Не удалось добавить участника. Проверьте username и попробуйте снова."})}finally{z(!1)}},q=async o=>{if(r)try{S(null),await x(r.id,o),await _()}catch(u){S("Не удалось удалить участника"),console.error("Error removing member:",u)}},J=o=>{p&&j({...p,photo_url:o}),b&&b(o),O(!1)};return r?e.jsxs(Me,{open:s,onClose:t,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"rgba(35, 43, 59, 0.95)",color:"white"}},children:[e.jsxs(Se,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(A,{sx:{position:"relative"},children:[e.jsx(je,{src:(p==null?void 0:p.photo_url)||r.photo_url||void 0,sx:{bgcolor:"#4a9eff",width:64,height:64},children:r.title?r.title[0].toUpperCase():e.jsx(Ke,{})}),e.jsx(de,{onClick:()=>O(!0),sx:{position:"absolute",bottom:-4,right:-4,bgcolor:"#4a9eff",color:"white",width:24,height:24,"&:hover":{bgcolor:"#3d8bdb"}},children:e.jsx($s,{sx:{fontSize:14}})})]}),e.jsxs(A,{children:[e.jsx(T,{variant:"h6",children:r.title||"Безымянный чат"}),e.jsx(T,{variant:"caption",sx:{color:"#8b95a1"},children:r.chat_type==="private"?"Личный чат":"Групповой чат"})]})]}),e.jsxs(Ie,{children:[i&&e.jsx(ie,{severity:"error",sx:{mb:2},children:i}),g?e.jsx(A,{sx:{display:"flex",justifyContent:"center",py:3},children:e.jsx(se,{sx:{color:"#4a9eff"}})}):p?e.jsxs(e.Fragment,{children:[e.jsxs(A,{sx:{mb:3},children:[e.jsx(T,{variant:"subtitle1",sx:{mb:1,fontWeight:600},children:"Информация"}),e.jsxs(T,{variant:"body2",sx:{color:"#8b95a1",mb:1},children:["ID чата: ",p.id]}),e.jsxs(T,{variant:"body2",sx:{color:"#8b95a1",mb:1},children:["Создан: ",new Date(p.created_at).toLocaleDateString("ru-RU")]}),p.description&&e.jsxs(T,{variant:"body2",sx:{color:"#8b95a1"},children:["Описание: ",p.description]})]}),e.jsxs(A,{sx:{mb:3},children:[e.jsxs(T,{variant:"subtitle1",sx:{mb:2,fontWeight:600},children:["Участники (",((F=p.members)==null?void 0:F.length)||0,")"]}),p.members&&p.members.length>0?e.jsx(tt,{sx:{maxHeight:200,overflow:"auto"},children:p.members.map(o=>e.jsxs(st,{sx:{bgcolor:"rgba(43, 52, 65, 0.5)",borderRadius:1,mb:1},children:[e.jsx(nt,{children:e.jsx(je,{src:o.profile_photo_url||void 0,sx:{bgcolor:"#4a9eff"},children:o.first_name?o.first_name[0].toUpperCase():e.jsx(Ke,{})})}),e.jsx(rt,{primary:e.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(T,{children:[o.first_name," ",o.last_name]}),o.is_admin&&e.jsx(ve,{icon:e.jsx(es,{}),label:"Админ",size:"small",sx:{bgcolor:"#4a9eff",color:"white",fontSize:"0.7rem"}})]}),secondary:e.jsx(T,{variant:"caption",sx:{color:"#8b95a1"},children:o.username?`@${o.username}`:`ID: ${o.telegram_id}`})}),y!==o.telegram_id&&e.jsx(_e,{title:"Удалить участника",children:e.jsx(de,{onClick:()=>q(o.telegram_id),sx:{color:"#f44336","&:hover":{bgcolor:"rgba(244, 67, 54, 0.1)"}},children:e.jsx(Ns,{})})})]},o.id))}):e.jsx(T,{variant:"body2",sx:{color:"#8b95a1",textAlign:"center",py:2},children:"Нет участников"})]}),e.jsxs(A,{children:[e.jsx(T,{variant:"subtitle1",sx:{mb:2,fontWeight:600},children:"Добавить участника"}),c&&e.jsx(ie,{severity:c.type==="success"?"success":c.type==="info"?"info":"warning",sx:{mb:2,"& .MuiAlert-message":{color:"white"},bgcolor:c.type==="success"?"rgba(76, 175, 80, 0.2)":c.type==="info"?"rgba(33, 150, 243, 0.2)":"rgba(255, 152, 0, 0.2)",border:`1px solid ${c.type==="success"?"#4CAF50":c.type==="info"?"#2196F3":"#FF9800"}`},children:c.message}),e.jsxs(A,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(Q,{variant:h==="username"?"contained":"outlined",onClick:()=>k("username"),size:"small",sx:{bgcolor:h==="username"?"#4a9eff":"transparent",color:h==="username"?"white":"#4a9eff",borderColor:"#4a9eff","&:hover":{bgcolor:h==="username"?"#3d8bdb":"rgba(74, 158, 255, 0.1)"}},children:"По @username"}),e.jsx(Q,{variant:h==="id"?"contained":"outlined",onClick:()=>k("id"),size:"small",sx:{bgcolor:h==="id"?"#4a9eff":"transparent",color:h==="id"?"white":"#4a9eff",borderColor:"#4a9eff","&:hover":{bgcolor:h==="id"?"#3d8bdb":"rgba(74, 158, 255, 0.1)"}},children:"По ID (авто)"})]}),h==="username"?e.jsxs(A,{sx:{display:"flex",gap:1},children:[e.jsx(ye,{size:"small",placeholder:"@username пользователя",value:E,onChange:o=>l(o.target.value),helperText:"💡 Если пользователь уже использовал приложение - добавится сразу. Если нет - получит приглашение.",sx:{flex:1,"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"#4a9eff"},"&.Mui-focused fieldset":{borderColor:"#4a9eff"}},"& .MuiFormHelperText-root":{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.75rem"}}}),e.jsx(Q,{variant:"contained",onClick:H,disabled:!E.trim()||D,startIcon:D?e.jsx(se,{size:16}):e.jsx(Qe,{}),sx:{bgcolor:"#4a9eff","&:hover":{bgcolor:"#3d8bdb"},minWidth:"120px"},children:D?"Поиск...":"Добавить"})]}):e.jsxs(A,{sx:{display:"flex",gap:1},children:[e.jsx(ye,{size:"small",placeholder:"ID или @username",value:v,onChange:o=>C(o.target.value),helperText:"💡 Можете ввести как Telegram ID (числа), так и @username - система определит автоматически",sx:{flex:1,"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"#4a9eff"},"&.Mui-focused fieldset":{borderColor:"#4a9eff"}},"& .MuiFormHelperText-root":{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.75rem"}}}),e.jsx(Q,{variant:"contained",onClick:U,disabled:!v.trim()||D,startIcon:D?e.jsx(se,{size:16}):e.jsx(Qe,{}),sx:{bgcolor:"#4a9eff","&:hover":{bgcolor:"#3d8bdb"},minWidth:"120px"},children:D?"Поиск...":"Добавить"})]})]})]}):e.jsx(T,{variant:"body2",sx:{textAlign:"center",py:3,color:"#8b95a1"},children:"Не удалось загрузить информацию о чате"})]}),e.jsx(De,{children:e.jsx(Q,{onClick:t,sx:{color:"#8b95a1"},children:"Закрыть"})}),e.jsxs(Me,{open:P,onClose:()=>O(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"rgba(35, 43, 59, 0.95)",color:"white"}},children:[e.jsx(Se,{children:"Изменить фото чата"}),e.jsxs(Ie,{children:[e.jsx(lt,{currentPhotoUrl:(p==null?void 0:p.photo_url)||r.photo_url||void 0,onPhotoChange:o=>{o?J(o):(p&&j({...p,photo_url:void 0}),b&&b(""))}}),e.jsx(A,{sx:{display:"flex",gap:1,mt:2,justifyContent:"flex-end"},children:e.jsx(Q,{onClick:()=>O(!1),sx:{color:"#8b95a1"},children:"Отмена"})})]})]})]}):null},ir=()=>{const s=Xe(),t=qt(s.breakpoints.down("md")),[r,n]=a.useState(""),[f,x]=a.useState(!1),[y,b]=a.useState(""),[p,j]=a.useState(""),[g,M]=a.useState(null),[i,S]=a.useState(null),[v,C]=a.useState(!1),[E,l]=a.useState(!1),[h,k]=a.useState(!1),D=a.useRef(null),{chats:z,currentChat:c,messages:m,currentUser:P,loading:O,messagesLoading:_,error:N,isAuthError:V,hasNewMessages:U,markMessagesAsViewed:H,sendNewMessage:q,createNewChat:J,selectChat:F,loadChatInfo:o,addMemberToChat:u,removeMemberFromChat:w,clearCurrentChat:R}=Hs(),$=()=>{var d;(d=D.current)==null||d.scrollIntoView({behavior:"smooth"})},L=()=>{R()};a.useEffect($,[m]),a.useEffect(()=>{if(U&&m.length>0){const d=setTimeout(()=>{H()},2e3);return()=>clearTimeout(d)}},[U,m.length,H]);const G=async()=>{if(!(!r.trim()||!c))try{H(),await q(c.id,r.trim()),n(""),$()}catch(d){console.error("Error sending message:",d)}},ee=d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),G())},I=async()=>{var d,X;try{C(!0),S(null);const W=[],K=[];p.trim()&&p.split(",").map(pe=>pe.trim()).filter(pe=>pe.length>0).forEach(pe=>{const Ae=parseInt(pe);!isNaN(Ae)&&Ae>0?W.push(Ae):K.push(pe.replace(/^@/,""))}),await J(y.trim(),W,K,g||void 0);let Te=`✅ Чат "${y.trim()}" создан успешно!`;W.length>0&&(Te+=` Добавлено ${W.length} участников.`),K.length>0&&(Te+=` Отправлено ${K.length} приглашений по username.`),S({type:"success",message:Te}),setTimeout(()=>{S(null),x(!1)},2e3),b(""),j(""),M(null)}catch(W){console.error("Error creating chat:",W);let K="Не удалось создать чат. Попробуйте еще раз.";W!=null&&W.isTimeoutError?K="⏱️ Сервер запускается, это может занять до минуты. Попробуйте еще раз.":W!=null&&W.isServiceError?K="🔧 Сервер временно недоступен. Попробуйте через несколько минут.":W!=null&&W.isAuthError?K="🔐 Ошибка авторизации. Откройте приложение из Telegram.":(W==null?void 0:W.code)==="ECONNABORTED"?K="⏱️ Превышено время ожидания. Сервер может запускаться - попробуйте еще раз.":((d=W==null?void 0:W.response)==null?void 0:d.status)===503?K="🔧 Сервер временно недоступен. Попробуйте через несколько минут.":((X=W==null?void 0:W.response)==null?void 0:X.status)===500&&(K="⚠️ Ошибка на сервере. Попробуйте еще раз или обратитесь в поддержку."),S({type:"warning",message:K})}finally{C(!1)}},B=d=>new Date(d).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),Z=d=>{const X=new Date(d),W=new Date,K=new Date(W);return K.setDate(K.getDate()-1),X.toDateString()===W.toDateString()?"Сегодня":X.toDateString()===K.toDateString()?"Вчера":X.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})},ce=d=>{const X=d.sender;return X.username?`@${X.username}`:`${X.first_name}${X.last_name?` ${X.last_name}`:""}`},re=d=>P&&d.sender_id===P.id;return O?e.jsx(A,{sx:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(35, 43, 59, 0.95)"},children:e.jsx(se,{sx:{color:"#4a9eff"}})}):V?e.jsxs(A,{sx:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",bgcolor:"rgba(35, 43, 59, 0.95)",p:3},children:[e.jsxs(ie,{severity:"error",sx:{mb:3,maxWidth:"600px"},children:[e.jsx(T,{variant:"h6",sx:{mb:2},children:"🚫 Ошибка авторизации"}),e.jsx(T,{variant:"body1",sx:{mb:2,fontWeight:"bold"},children:"Проблема с авторизацией на сервере"}),e.jsx(T,{variant:"body2",sx:{mb:2},children:"Сервер отклоняет авторизацию. Возможные причины:"}),e.jsxs(T,{variant:"body2",component:"ul",sx:{pl:2,mb:2},children:[e.jsx("li",{children:"На сервере не настроен токен Telegram бота"}),e.jsx("li",{children:"Неправильный или истёкший токен бота"}),e.jsx("li",{children:"Проблема с подписью данных авторизации"}),e.jsx("li",{children:"Приложение запущено не из Telegram"})]}),e.jsx(T,{variant:"body2",sx:{mb:2},children:e.jsx("strong",{children:"Что делать:"})}),e.jsxs(T,{variant:"body2",component:"ul",sx:{pl:2,mb:2},children:[e.jsx("li",{children:'Нажмите "Диагностика" для подробной проверки'}),e.jsx("li",{children:"Убедитесь, что приложение открыто из Telegram"}),e.jsx("li",{children:"Если вы администратор - проверьте настройки сервера"}),e.jsx("li",{children:"Если проблема повторяется - обратитесь в поддержку"})]})]}),e.jsxs(A,{sx:{display:"flex",gap:2,flexWrap:"wrap",justifyContent:"center"},children:[e.jsx(Q,{variant:"contained",onClick:()=>l(!0),sx:{bgcolor:"#f44336","&:hover":{bgcolor:"#d32f2f"}},children:"🔬 Диагностика проблемы"}),e.jsx(Q,{variant:"outlined",onClick:()=>{var d;(d=window.Telegram)!=null&&d.WebApp?window.Telegram.WebApp.close():window.history.back()},sx:{borderColor:"#4a9eff",color:"#4a9eff","&:hover":{borderColor:"#3d8bdb",color:"#3d8bdb"}},children:"⬅️ Назад"})]})]}):e.jsxs(A,{sx:{height:"100vh",display:"flex",bgcolor:"rgba(35, 43, 59, 0.95)",color:"white",overflow:"hidden"},children:[e.jsxs(A,{sx:{width:t?"100%":"350px",display:t&&c?"none":"flex",flexDirection:"column",borderRight:"1px solid rgba(43, 52, 65, 1)",bgcolor:"rgba(35, 43, 59, 0.95)"},children:[e.jsx(A,{sx:{p:t?1:2,borderBottom:"1px solid rgba(43, 52, 65, 1)",display:"flex",alignItems:"center",justifyContent:"space-between",minHeight:t?"52px":"auto"},children:e.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:1,cursor:"pointer",p:1,borderRadius:2,"&:hover":{bgcolor:"rgba(74, 158, 255, 0.1)"},"&:active":{bgcolor:"rgba(74, 158, 255, 0.2)"}},onClick:()=>x(!0),onContextMenu:d=>{d.preventDefault(),x(!0)},children:[e.jsx(T,{variant:t?"body1":"h6",sx:{fontWeight:600,fontSize:t?"1rem":"inherit"},children:"Чаты"}),e.jsx(T,{variant:"caption",sx:{color:"#8b95a1",fontSize:t?"0.6rem":"0.7rem",ml:.5},children:"(нажмите для создания)"})]})}),e.jsx(tt,{sx:{flex:1,overflow:"auto",p:0},children:z.map(d=>e.jsx(Fe.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsx(st,{disablePadding:!0,sx:{borderBottom:"1px solid rgba(43, 52, 65, 0.5)"},children:e.jsxs(Zt,{selected:(c==null?void 0:c.id)===d.id,onClick:()=>F(d),sx:{py:t?1.25:1.5,px:t?1:2,bgcolor:(c==null?void 0:c.id)===d.id?"rgba(74, 158, 255, 0.1)":"transparent","&:hover":{bgcolor:(c==null?void 0:c.id)===d.id?"rgba(74, 158, 255, 0.15)":"rgba(255, 255, 255, 0.05)"},minHeight:t?64:"auto"},children:[e.jsx(nt,{children:e.jsx(Ts,{badgeContent:d.unread_count,color:"error",invisible:d.unread_count===0,children:e.jsx(je,{src:d.photo_url||void 0,sx:{bgcolor:"#4a9eff",width:t?44:45,height:t?44:45},children:d.title?d.title[0].toUpperCase():e.jsx(ke,{})})})}),e.jsx(rt,{primary:e.jsx(T,{variant:"body1",sx:{fontWeight:d.unread_count>0?600:400,color:"white",fontSize:t?"0.9rem":"inherit"},children:d.title||"Безымянный чат"}),secondary:e.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(T,{variant:"caption",sx:{color:"#8b95a1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:t?"120px":"150px",fontSize:t?"0.75rem":"inherit"},children:d.last_message||"Нет сообщений"}),d.last_message_time&&e.jsx(T,{variant:"caption",sx:{color:"#8b95a1",fontSize:t?"0.65rem":"0.7rem",ml:1},children:Z(d.last_message_time)})]})})]})})},d.id))})]}),e.jsx(A,{sx:{flex:1,display:"flex",flexDirection:"column",position:"relative"},children:c?e.jsxs(e.Fragment,{children:[e.jsxs(A,{sx:{position:"fixed",top:0,left:t?0:"350px",right:0,zIndex:1300,p:t?.75:2,borderBottom:"1px solid rgba(43, 52, 65, 1)",bgcolor:"rgba(35, 43, 59, 0.98)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",display:"flex",alignItems:"center",justifyContent:"space-between",minHeight:t?"56px":"64px",boxShadow:"0 2px 20px rgba(0,0,0,0.15)"},children:[e.jsxs(A,{sx:{display:"flex",alignItems:"center",flex:1},children:[t&&e.jsx(de,{onClick:L,sx:{color:"#4a9eff",mr:.5,p:.5,"&:hover":{bgcolor:"rgba(74, 158, 255, 0.1)"}},children:e.jsx(Yt,{})}),e.jsx(je,{src:c.photo_url||void 0,sx:{bgcolor:"#4a9eff",width:t?32:40,height:t?32:40,mr:t?1:2},children:c.title?c.title[0].toUpperCase():e.jsx(ke,{})}),e.jsxs(A,{sx:{flex:1,minWidth:0},children:[e.jsxs(T,{variant:t?"body2":"h6",sx:{fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:t?.5:1,fontSize:t?"0.875rem":"inherit"},children:[c.title||"Безымянный чат",U&&e.jsx(A,{sx:{width:t?6:8,height:t?6:8,borderRadius:"50%",bgcolor:"#4CAF50",animation:"pulse 2s infinite","@keyframes pulse":{"0%":{transform:"scale(1)",opacity:1},"50%":{transform:"scale(1.2)",opacity:.7},"100%":{transform:"scale(1)",opacity:1}}}})]}),e.jsxs(T,{variant:"caption",sx:{color:"#8b95a1",fontSize:t?"0.65rem":"0.75rem",lineHeight:t?1.2:"inherit"},children:[c.chat_type==="private"?"Личный чат":"Групповой чат",U&&(t?" • Новые":" • Новые сообщения")]})]})]}),e.jsx(A,{sx:{display:"flex",gap:t?.25:1},children:e.jsx(_e,{title:"Информация о чате",children:e.jsx(de,{onClick:()=>k(!0),sx:{color:"#4a9eff",p:t?.5:1.5,"&:hover":{bgcolor:"rgba(74, 158, 255, 0.1)"}},children:e.jsx(it,{fontSize:t?"small":"medium"})})})})]}),e.jsxs(A,{sx:{flex:1,overflow:"auto",p:t?.5:1.5,pt:t?7:9,bgcolor:"rgba(35, 43, 59, 0.95)",backgroundImage:`url(${Ue})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"local",position:"relative","&::-webkit-scrollbar":{width:t?"3px":"6px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"rgba(255, 255, 255, 0.2)",borderRadius:t?"1.5px":"3px"},"&::-webkit-scrollbar-thumb:hover":{background:"rgba(255, 255, 255, 0.3)"}},children:[N&&e.jsx(ie,{severity:"error",sx:{mb:t?1:2},children:N}),_?e.jsx(A,{sx:{display:"flex",justifyContent:"center",py:t?2:4},children:e.jsx(se,{sx:{color:"#4a9eff"}})}):e.jsx(Ps,{children:m.map(d=>e.jsx(Fe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},style:{display:"flex",justifyContent:re(d)?"flex-end":"flex-start",marginBottom:t?"8px":"12px"},children:e.jsxs(A,{sx:{maxWidth:t?"85%":"70%",px:t?1.25:2,py:t?.75:1.2,borderRadius:re(d)?"18px 18px 4px 18px":"18px 18px 18px 4px",bgcolor:re(d)?"#4a9eff":"rgba(43, 52, 65, 0.9)",color:"white",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",wordBreak:"break-word"},children:[!re(d)&&e.jsx(T,{variant:"caption",sx:{color:"#40C4FF",fontWeight:600,display:"block",mb:t?.25:.5,fontSize:t?"0.7rem":"0.75rem"},children:ce(d)}),e.jsx(T,{variant:"body1",sx:{mb:t?.25:.5,fontSize:t?"0.875rem":"0.95rem",lineHeight:t?1.3:1.4},children:d.text}),e.jsx(T,{variant:"caption",sx:{opacity:.7,fontSize:t?"0.6rem":"0.7rem",display:"block",textAlign:"right",mt:t?.125:.25,color:re(d)?"rgba(255,255,255,0.8)":"#8b95a1"},children:B(d.created_at)})]})},d.id))}),e.jsx("div",{ref:D})]}),e.jsxs(A,{sx:{p:t?1:2,bgcolor:"rgba(35, 43, 59, 0.95)",display:"flex",gap:t?.75:1.5,alignItems:"flex-end",borderTop:"1px solid rgba(43, 52, 65, 1)",pb:t?"max(1rem, env(safe-area-inset-bottom))":2},children:[e.jsx(ye,{fullWidth:!0,multiline:!0,maxRows:t?2:4,value:r,onChange:d=>n(d.target.value),onKeyPress:ee,placeholder:"Напишите сообщение...",variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:t?"16px":"20px",bgcolor:"rgba(35, 46, 60, 1)",border:"none",fontSize:t?"0.875rem":"0.95rem",color:"white","& fieldset":{border:"1px solid rgba(60, 72, 84, 1)"},"&:hover fieldset":{border:"1px solid #4a9eff"},"&.Mui-focused fieldset":{border:"2px solid #4a9eff"},"& .MuiInputBase-input":{padding:t?"8px 12px":"12px 16px",color:"white","&::placeholder":{color:"rgba(255, 255, 255, 0.5)",opacity:1}}}}}),e.jsx(de,{onClick:G,disabled:!r.trim(),size:"medium",sx:{bgcolor:"#4a9eff",color:"white",width:t?36:44,height:t?36:44,minWidth:t?36:44,minHeight:t?36:44,"&:hover":{bgcolor:"#3d8bdb",transform:"scale(1.05)"},"&:disabled":{bgcolor:"rgba(60, 72, 84, 1)",color:"#8b95a1"},transition:"all 0.2s ease"},children:e.jsx(ts,{sx:{fontSize:t?"1rem":"1.2rem"}})})]})]}):e.jsx(A,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",bgcolor:"rgba(35, 43, 59, 0.95)",backgroundImage:`url(${Ue})`,backgroundSize:"cover",backgroundPosition:"center",backgroundBlendMode:"overlay"},children:e.jsxs(A,{sx:{textAlign:"center"},children:[e.jsx(ke,{sx:{fontSize:80,color:"#4a9eff",mb:2}}),e.jsx(T,{variant:"h5",sx:{mb:1,color:"white"},children:"Выберите чат"}),e.jsx(T,{variant:"body1",sx:{color:"#8b95a1"},children:"Выберите чат из списка или создайте новый"})]})})}),e.jsxs(Me,{open:f,onClose:()=>{x(!1),S(null),M(null)},maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"rgba(35, 43, 59, 0.95)",color:"white"}},children:[e.jsx(Se,{children:"Создать новый чат"}),e.jsxs(Ie,{children:[i&&e.jsx(ie,{severity:i.type==="success"?"success":"warning",sx:{mb:2,"& .MuiAlert-message":{color:"white"},bgcolor:i.type==="success"?"rgba(76, 175, 80, 0.2)":"rgba(255, 152, 0, 0.2)",border:`1px solid ${i.type==="success"?"#4CAF50":"#FF9800"}`},children:i.message}),e.jsx(ye,{autoFocus:!0,margin:"dense",label:"Название чата",fullWidth:!0,variant:"outlined",value:y,onChange:d=>b(d.target.value),sx:{mb:2,"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"#4a9eff"},"&.Mui-focused fieldset":{borderColor:"#4a9eff"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)","&.Mui-focused":{color:"#4a9eff"}}}}),e.jsx(ye,{margin:"dense",label:"Участники (ID или @username, через запятую)",fullWidth:!0,variant:"outlined",placeholder:"Например: 123456789, @username, 987654321, @user2",value:p,onChange:d=>j(d.target.value),helperText:"💡 Поддерживаются как Telegram ID (числа), так и @username. Если пользователь не найден по username - получит приглашение.",sx:{mb:1,"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"#4a9eff"},"&.Mui-focused fieldset":{borderColor:"#4a9eff"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)","&.Mui-focused":{color:"#4a9eff"}},"& .MuiFormHelperText-root":{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.75rem"}}}),e.jsxs(A,{sx:{mt:3,mb:2},children:[e.jsx(T,{variant:"subtitle2",sx:{mb:2,color:"rgba(255, 255, 255, 0.8)"},children:"Фото чата (необязательно)"}),e.jsx(lt,{currentPhotoUrl:g||void 0,onPhotoChange:M,disabled:v,size:100})]})]}),e.jsxs(De,{children:[e.jsx(Q,{onClick:()=>{x(!1),S(null)},sx:{color:"#8b95a1"},children:"Отмена"}),e.jsx(Q,{onClick:I,disabled:!y.trim()||v,startIcon:v?e.jsx(se,{size:16}):void 0,sx:{bgcolor:"#4a9eff",color:"white","&:hover":{bgcolor:"#3d8bdb"},"&:disabled":{bgcolor:"rgba(60, 72, 84, 1)",color:"#8b95a1"}},children:v?"Создаём...":"Создать"})]})]}),e.jsx(Vs,{open:E,onClose:()=>l(!1)}),e.jsx(Gs,{open:h,onClose:()=>k(!1),currentChat:c,loadChatInfo:o,addMemberToChat:u,removeMemberFromChat:w,currentUserId:P==null?void 0:P.telegram_id,onChatPhotoUpdate:d=>{console.log("Chat photo updated:",d)}})]})};export{ir as default};
